function Snippeter(t){this.snippets=[],this.inputElements=null,this.startTag="#",this.listElement=null,this.caretTag="[SnippeterCaretTag]",this.excludeSign="-","snippets"in t&&(this.snippets=t.snippets),"inputElements"in t&&(this.inputElements=t.inputElements),"startTag"in t&&(this.startTag=t.startTag),"snippetToHtml"in t&&(this.snippetToHtml=t.snippetToHtml),"listElement"in t&&(this.listElement=t.listElement),"caretTag"in t&&(this.caretTag=t.caretTag),"excludeSign"in t&&(this.excludeSign=t.excludeSign),"snippetMatcher"in t&&(this.snippetMatcher=t.snippetMatcher),"highlighter"in t&&(this.highlighter=t.highlighter),"snippetKeywords"in t&&(this.snippetKeywords=t.snippetKeywords),"snippetValue"in t&&(this.snippetValue=t.snippetValue),this.init()}Snippeter.prototype.init=function(){this.inputElements=$(this.inputElements),this.listElement=$(this.listElement);var t=this;this.inputElements.on("keydown",function(e){t.keydown(e)}),this.inputElements.on("keyup click focusin",function(e){[9,13,27,38,40].indexOf(e.keyCode)<=-1&&t.inputElementUpdate($(e.target))}),$(document).click(function(e){e.target===t.listElement[0]||$.contains(t.listElement[0],e.target)||t.inputElements.index(e.target)>=0||t.cleanList(t.inputElements.first())})},Snippeter.prototype.keydown=function(t){var e=$(t.target);if(9===t.keyCode)return void this.cleanList(e);var i=e.val(),s=e.caret(),n=i.substring(0,s).lastIndexOf(this.startTag);n>=0&&(13===t.keyCode?(t.preventDefault(),this.insertSelected()):27===t.keyCode?(this.deleteTag(e),this.inputElementUpdate(e)):38===t.keyCode?(t.preventDefault(),this.selectionUp()):40===t.keyCode&&(t.preventDefault(),this.selectionDown()))},Snippeter.prototype.inputElementUpdate=function(t){console.log("inputElementUpdate: ",t);var e=t.val(),i=t.caret(),s=e.substring(0,i).lastIndexOf(this.startTag);if(s>=0){var n=e.substring(s+this.startTag.length,i),r=this.filterSnippets(n);this.updateList(r,n,t)}else this.cleanList(t)},Snippeter.prototype.selectFirst=function(){this.listElement.children(".selected").removeClass("selected"),this.listElement.children().first().addClass("selected").trigger("select")},Snippeter.prototype.selectLast=function(){this.listElement.children(".selected").removeClass("selected"),this.listElement.children().last().addClass("selected").trigger("select")},Snippeter.prototype.selectionUp=function(){var t=this.listElement.children(".selected");t.removeClass("selected"),t.prev().length?t.prev().addClass("selected").trigger("select"):this.selectLast()},Snippeter.prototype.selectionDown=function(){var t=this.listElement.children(".selected");t.removeClass("selected"),t.next().length?t.next().addClass("selected").trigger("select"):this.selectFirst()},Snippeter.prototype.insertSelected=function(){this.listElement.children(".selected").trigger("insert")},Snippeter.prototype.filterSnippets=function(t){if(console.log("filterSnippets: ",t),""===t)return this.snippets;var e=this,i=this.snippets.filter(function(i){return e.snippetMatcher(i,t)});return i},Snippeter.prototype.cleanList=function(t){console.log("cleanList: ",t),this.listElement.empty(),this.listElement.trigger({type:"update",relatedTarget:t[0]})},Snippeter.prototype.updateList=function(t,e,i){if(console.log("updateList: ",t,e,i),this.listElement.empty(),t&&t.length){var s=this;t.forEach(function(t){var n=s.snippetToHtml(t);n=s.highlighter(n,e);var r=$(n);r.on("click insert",function(){s.insert(t,i),s.inputElementUpdate(i)}),r.appendTo(s.listElement)})}this.listElement.trigger({type:"update",relatedTarget:i[0]}),this.selectFirst()},Snippeter.prototype.insert=function(t,e){console.log("insert: ",t);var i,s=e.val(),n=e.caret(),r=s.substring(0,n).lastIndexOf(this.startTag);"string"==typeof t&&(i=t),"object"==typeof t&&(i=this.snippetValue(t)),e.val(s.substring(0,r)+i+s.substring(n)),e.caret(r+i.length);var p=e.val().substring(0,e.caret()).lastIndexOf(this.caretTag);p>=0&&(e.val(e.val().replace(this.caretTag,"")),e.caret(p))},Snippeter.prototype.deleteTag=function(t){console.log("deleteTag ");var e=t.val(),i=t.caret(),s=e.substring(0,i).lastIndexOf(this.startTag);t.val(e.substring(0,s)+e.substring(i)),t.caret(s)},Snippeter.prototype.snippetMatcher=function(t,e){var i,s=e.split(" ");for(i=0;i<s.length;i++){var n=s[i];if(this.wordExcludesSnippet(n,t))return!1}return!0},Snippeter.prototype.wordExcludesSnippet=function(t,e){var i=!0;if(t.charAt(0)===this.excludeSign&&(t=t.substring(1),i=!1)," "===t||""===t)return!1;var s=new RegExp("("+t+")","gi"),n=!1;return"string"==typeof e&&(n=$.isArray(e.replace(this.caretTag,"").match(s))),"object"==typeof e&&(n=$.isArray(this.snippetKeywords(e).match(s))||$.isArray(this.snippetValue(e).replace(this.caret,"").match(s))),i!==n},Snippeter.prototype.snippetToHtml=function(t){return"string"==typeof t?"<div>"+t.replace(this.caretTag,"")+"</div>":"object"==typeof t?'<div><div class="keywords">'+this.snippetKeywords(t)+'</div><div class="value">'+this.snippetValue(t).replace(this.caretTag,"")+"</div></div>":void 0},Snippeter.prototype.highlighter=function(t,e){if(""===e)return t;var i,s=e.split(" ");for(i=0;i<s.length;i++)if(s[i].length>1){var n=new RegExp("("+s[i]+")","gi");t=t.replace(n,'<span class="highlight">$1</span>')}return t},Snippeter.prototype.snippetKeywords=function(t){return t.keywords},Snippeter.prototype.snippetValue=function(t){return t.value};